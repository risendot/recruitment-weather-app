app.controller("MasterController",["$mdSidenav","WeatherService",function(a,b){function c(){console.log("MasterController")}var d=this;this.config=b.config,this.loading=b.loading,this.favorites=b.favorites,this.toggleMenu=function(){a("right").toggle()},this.logout=function(){window.location.href="/"},this.deleteFromFavorites=function(a){a&&b.deleteFromFavorites(a)},this.selectFavorite=function(a){a&&(d.loading.weather=!0,b.getCurrentWeatherByID(a.id))},c()}]),app.controller("WeatherController",["$scope","$interval","$mdToast","WeatherService",function(a,b,c,d){function e(a){d.getCurrentWeatherByID(a)}function f(){console.log("WeatherController"),g.loading.weather=!0;var a=JSON.parse(localStorage.getItem("_weatherDefault_"));null!==a&&a.id&&a.name?e(a.id):d.getGeoLocation()}var g=this;this.weather=d.weather,this.forecast=d.forecast,this.loading=d.loading,this.model={search:""},this.config=d.config,this.popular=[{name:"Warsaw",id:756135},{name:"Washington",id:5815135},{name:"San Francisco",id:5391959},{name:"London",id:2643743},{name:"Paris",id:2988507}],this.choosePopular=function(a){a&&(g.loading.weather=!0,e(a.id))},this.searchCity=function(){g.loading.weather=!0,d.getCurrentWeatherByName(g.model.search)},this.getWeatherIcon=function(a){if(a){if(a.weather instanceof Array)var b=a.weather[0].icon;return b?"http://openweathermap.org/img/w/"+b+".png":""}},this.toggleForecast=function(){g.config.forecast=9===g.config.forecast?g.forecast.list.length:9},this.disableAddButton=function(a){if(a)return d.compareToFavorites(a)},this.addToFavorites=function(a){if(a){var b="";b=d.addToFavorites(a)?"Added to favorites!":"Location already in favorites",c.show(c.simple().textContent(b).hideDelay(3e3))}},this.setAsDefault=function(a){if(a){var b={id:a.id,name:a.name};localStorage.setItem("_weatherDefault_",JSON.stringify(b)),c.show(c.simple().textContent("New default location!").hideDelay(3e3))}},b(function(){e(g.config.id)},6e4),f()}]),app.service("WeatherService",["$http","API_KEY",function(a,b){function c(c,e,g){a.get("http://api.openweathermap.org/data/2.5/weather?"+e+"="+c+"&APPID="+b.OW).then(function(a){d(a.data),angular.copy(a.data,f.weather),"function"==typeof g&&g(a.data)}),a.get("http://api.openweathermap.org/data/2.5/forecast?"+e+"="+c+"&APPID="+b.OW).then(function(a){angular.copy(a.data,f.forecast),f.loading.weather=!1})}function d(a){if(a){var b=!1;for(var c in g)g[c]===a.weather[0].id&&(b=!0);f.config.theme=b?"good-weather":"bad-weather",f.config.updateTime=moment().format("YYYY-MM-DD HH:mm:ss"),f.config.id=a.id,f.config.name=a.name}}function e(){console.log("WeatherService");var a=JSON.parse(localStorage.getItem("_weatherFavorites_"));null!==a&&a instanceof Array&&angular.copy(a,f.favorites)}var f=this;this.loading={weather:!1},this.weather={},this.forecast={},this.config={theme:"good-weather",name:"",id:null,forecast:9,updateTime:""},this.favorites=[];var g=[500,501,502,503,504,800,801,802,951,952,953,954];this.getCurrentWeatherByID=function(a,b){c(a,"id",b)},this.getCurrentWeatherByName=function(a,b){c(a,"q",b)},this.compareToFavorites=function(a){if(a){var b=!1;for(var c in f.favorites){var d=f.favorites[c];d.name===a.name&&d.id===a.id&&(b=!0)}return b}},this.addToFavorites=function(a){if(a){var b={id:a.id,name:a.name};return!f.compareToFavorites(b)&&(f.favorites.push(b),localStorage.setItem("_weatherFavorites_",JSON.stringify(f.favorites)),!0)}},this.deleteFromFavorites=function(a){a&&(f.favorites.splice(f.favorites.indexOf(a),1),localStorage.setItem("_weatherFavorites_",JSON.stringify(f.favorites)))};var h={macAddress:"00:25:9c:cf:1c:ac",signalStrength:-43,age:0,channel:11,signalToNoiseRatio:0};this.getGeoLocation=function(c){a.post("https://www.googleapis.com/geolocation/v1/geolocate?key="+b.GEO,h).then(function(e){a.get("http://api.openweathermap.org/data/2.5/weather?lat="+e.data.location.lat+"&lon="+e.data.location.lat+"&APPID="+b.OW).then(function(a){d(a.data),angular.copy(a.data,f.weather),"function"==typeof c&&c(a.data)}),a.get("http://api.openweathermap.org/data/2.5/forecast?lat="+e.data.location.lat+"&lon="+e.data.location.lat+"&APPID="+b.OW).then(function(a){angular.copy(a.data,f.forecast),f.loading.weather=!1})})},e()}]),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("weatherMain",{url:"/",templateUrl:"/weather/tpl/main",controller:"WeatherController",controllerAs:"wc"})}]);